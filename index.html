<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pack My Bag ‚Äì Travel Assistant</title>
  <link rel="manifest" href="./manifest.json"/>
  <meta name="theme-color" content="#2196f3"/>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, #6dd5fa, #2980b9);
      color: #fff;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    header {
      text-align: center;
      padding: 1rem;
      background: rgba(0,0,0,0.2);
    }
    h1 {
      margin: 0;
      font-size: 1.8rem;
    }
    main {
      flex: 1;
      padding: 1rem;
      overflow-y: auto;
    }
    .trip-card {
      background: #fff;
      color: #333;
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 1rem;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      transition: transform .2s;
    }
    .trip-card:hover { transform: scale(1.02); }
    .btn {
      padding: .6rem 1rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      margin: .2rem;
    }
    .btn-primary { background: linear-gradient(45deg, #00c6ff, #0072ff); color: white; }
    .btn-danger { background: crimson; color: white; }
    .btn-secondary { background: #eee; color: #333; }
    .progress-bar {
      background: #eee;
      border-radius: 6px;
      overflow: hidden;
      margin: .3rem 0;
    }
    .progress {
      height: 8px;
      background: linear-gradient(90deg, #00c6ff, #0072ff);
    }
    .category {
      margin-top: .5rem;
      background: #f4f4f4;
      padding: .5rem;
      border-radius: 8px;
      cursor: pointer;
    }
    .category h4 { margin: 0; font-size: 1rem; color: #0072ff; }
    .items { display: none; padding-top: .4rem; }
    .item {
      display: flex; align-items: center; justify-content: space-between;
      margin: .3rem 0;
      background: #fff;
      border-radius: 6px;
      padding: .3rem .6rem;
      color: #333;
    }
    .item img { width: 32px; height: 32px; border-radius: 4px; margin-right: .5rem; }
    .gallery { display: flex; flex-wrap: wrap; gap: .5rem; margin-top: .5rem; }
    .gallery img { width: 60px; height: 60px; border-radius: 8px; object-fit: cover; }
    #tripForm {
      display: flex; flex-direction: column; gap: .5rem;
      background: rgba(255,255,255,0.2);
      padding: 1rem;
      border-radius: 12px;
      margin-bottom: 1rem;
    }
    input, select {
      padding: .5rem; border-radius: 6px; border: none;
    }
    footer {
      background: rgba(0,0,0,0.2);
      padding: .6rem;
      text-align: center;
    }
  </style>
</head>
<body>
  <header>
    <h1>‚úàÔ∏è Pack My Bag ‚Äì Travel Assistant</h1>
    <p>Your smart packing companion</p>
  </header>

  <main>
    <form id="tripForm">
      <input type="text" id="tripName" placeholder="Trip Name (e.g. Goa)" required/>
      <input type="date" id="tripDate" required/>
      <select id="tripType">
        <option value="casual">Casual</option>
        <option value="beach">Beach</option>
        <option value="business">Business</option>
        <option value="trek">Trek</option>
      </select>
      <button type="submit" class="btn btn-primary">‚ûï Add Trip</button>
    </form>
    <div id="trips"></div>
  </main>

  <footer>
    <button id="installBtn" class="btn btn-secondary">üì≤ Install Travel Assistant</button>
  </footer>

  <script>
    let trips = JSON.parse(localStorage.getItem("trips") || "[]");
    const tripsDiv = document.getElementById("trips");

    const defaultItems = {
      casual: ["T-shirts", "Pants", "Shoes", "Toothbrush"],
      beach: ["Swimsuit", "Sunscreen", "Flip-flops", "Hat"],
      business: ["Formal Suit", "Laptop", "Charger", "Notepad"],
      trek: ["Trekking Shoes", "Water Bottle", "Jacket", "Snacks"]
    };

    function renderTrips() {
      tripsDiv.innerHTML = "";
      trips.forEach((trip, idx) => {
        const daysLeft = Math.ceil((new Date(trip.date) - new Date())/ (1000*60*60*24));
        const card = document.createElement("div");
        card.className = "trip-card";
        card.innerHTML = `
          <h2>${trip.name} (${trip.type})</h2>
          <p>üìÖ ${trip.date} ‚Äî <b>${daysLeft >= 0 ? daysLeft+" days left" : "Completed"}</b></p>
          <button onclick="addItem(${idx})" class="btn btn-primary">‚ûï Add Item</button>
          <button onclick="smartPack(${idx})" class="btn btn-secondary">‚ú® Smart Pack</button>
          <button onclick="deleteTrip(${idx})" class="btn btn-danger">üóëÔ∏è Delete Trip</button>
          <div id="categories-${idx}"></div>
          <div class="gallery" id="gallery-${idx}"></div>
        `;
        tripsDiv.appendChild(card);
        renderCategories(idx);
      });
    }

    function renderCategories(tripIndex) {
      const categoriesDiv = document.getElementById("categories-" + tripIndex);
      categoriesDiv.innerHTML = "";
      const categories = ["Clothes", "Accessories", "Electronics", "Skincare", "Travel Essentials"];
      categories.forEach(cat => {
        const section = document.createElement("div");
        section.className = "category";
        const items = trips[tripIndex].items.filter(i => i.category === cat);
        const progress = items.length;
        section.innerHTML = `
          <h4 onclick="toggleItems(${tripIndex},'${cat}')">${cat} (${progress})</h4>
          <div class="progress-bar"><div class="progress" style="width:${progress*25}%;"></div></div>
          <div class="items" id="items-${tripIndex}-${cat}"></div>
        `;
        categoriesDiv.appendChild(section);
        const itemsDiv = section.querySelector(".items");
        items.forEach((item, i) => {
          const row = document.createElement("div");
          row.className = "item";
          row.innerHTML = `
            <div><img src="${item.photo||'icon-192.png'}"/> ${item.name}</div>
            <button onclick="deleteItem(${tripIndex},${i})" class="btn btn-danger">x</button>
          `;
          itemsDiv.appendChild(row);
        });
        const galleryDiv = document.getElementById("gallery-" + tripIndex);
        galleryDiv.innerHTML = "";
        trips[tripIndex].items.forEach(it=>{
          if(it.photo) {
            const img=document.createElement("img");
            img.src=it.photo;
            galleryDiv.appendChild(img);
          }
        });
      });
      localStorage.setItem("trips", JSON.stringify(trips));
    }

    function toggleItems(tripIndex, cat) {
      const el = document.getElementById(`items-${tripIndex}-${cat}`);
      el.style.display = el.style.display === "block" ? "none" : "block";
    }

    document.getElementById("tripForm").addEventListener("submit", e => {
      e.preventDefault();
      const trip = {
        name: document.getElementById("tripName").value,
        date: document.getElementById("tripDate").value,
        type: document.getElementById("tripType").value,
        items: []
      };
      trips.push(trip);
      renderTrips();
      e.target.reset();
    });

    function addItem(tripIndex) {
      const name = prompt("Item name?");
      if (!name) return;
      const cat = prompt("Category? (Clothes, Accessories, Electronics, Skincare, Travel Essentials)");
      const photoInput = document.createElement("input");
      photoInput.type = "file";
      photoInput.accept = "image/*";
      photoInput.capture = "environment";
      photoInput.onchange = e=>{
        const file = e.target.files[0];
        const reader=new FileReader();
        reader.onload = ()=>{
          trips[tripIndex].items.push({name, category:cat, photo:reader.result});
          renderTrips();
        };
        reader.readAsDataURL(file);
      };
      photoInput.click();
    }

    function smartPack(tripIndex) {
      const type = trips[tripIndex].type;
      defaultItems[type].forEach(it=>{
        trips[tripIndex].items.push({name:it, category:"Clothes", photo:""});
      });
      renderTrips();
    }

    function deleteTrip(idx) {
      trips.splice(idx,1);
      renderTrips();
    }
    function deleteItem(tripIdx, itemIdx) {
      trips[tripIdx].items.splice(itemIdx,1);
      renderTrips();
    }

    renderTrips();

    // PWA Install
    let deferredPrompt;
    const installBtn=document.getElementById("installBtn");
    window.addEventListener("beforeinstallprompt", e=>{
      e.preventDefault();
      deferredPrompt=e;
      installBtn.style.display="inline-block";
    });
    installBtn.addEventListener("click", ()=>{
      if(deferredPrompt){ deferredPrompt.prompt(); }
    });

    if('serviceWorker' in navigator){
      navigator.serviceWorker.register('./sw.js');
    }
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pack My Bag</title>
  <meta name="description" content="Plan smarter trips: choose your bag, track liters, and build a categorized packing list with photos." />
  <meta name="theme-color" content="#0f172a" />
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon-192.png">
  <link rel="icon" href="icon-192.png">

  <style>
    body { font-family:'Segoe UI',sans-serif; background:#0f172a; color:#f1f5f9; padding:20px; margin:0; display:flex; flex-direction:column; align-items:center; }
    h1 { color:#22d3ee; margin-bottom:10px; }
    h2 { color:#38bdf8; margin-top:20px; }
    p { color:#94a3b8; margin-bottom:15px; text-align:center; }
    .card { background:#1e293b; padding:15px; border-radius:12px; margin-bottom:20px; width:100%; max-width:500px; box-shadow:0 2px 8px rgba(0,0,0,0.4); }
    .input-row { display:flex; gap:10px; margin-bottom:10px; flex-wrap:wrap; }
    input, select { flex:1; padding:10px; border-radius:8px; border:none; outline:none; font-size:14px; }
    button { padding:10px 20px; border-radius:8px; border:none; cursor:pointer; font-weight:bold; transition:0.2s; }
    .primary { background:#22d3ee; color:#0f172a; }
    .primary:hover { background:#0ea5e9; }
    ul { list-style:none; padding:0; margin-top:10px; width:100%; }
    li { background:#0f172a; margin:6px 0; padding:10px; border-radius:8px; display:flex; justify-content:space-between; align-items:center; }
    li.packed { text-decoration: line-through; opacity:0.6; }
    .category { font-size:13px; color:#22d3ee; margin-left:5px; }
    .progress { margin-top:10px; background:#1e293b; border-radius:10px; overflow:hidden; height:12px; }
    .progress-bar { height:100%; background:#22d3ee; width:0%; transition:width 0.4s ease; }
    .item-left { display:flex; align-items:center; gap:10px; }
    .thumb { width:40px; height:40px; object-fit:cover; border-radius:6px; }
  </style>
</head>
<body>
  <h1>🎒 Pack My Bag</h1>

  <!-- Bag Setup -->
  <div class="card">
    <h2>Bag Setup</h2>
    <p>Select your bag type and capacity.</p>
    <div class="input-row">
      <select id="bagType">
        <option value="Backpack">🎒 Backpack</option>
        <option value="Suitcase">🧳 Suitcase</option>
        <option value="Duffel">👜 Duffel Bag</option>
      </select>
      <input type="number" id="bagCapacity" placeholder="Liters (e.g. 40)" />
    </div>
  </div>

  <!-- Packing List -->
  <div class="card">
    <h2>Packing List</h2>
    <div class="input-row">
      <input type="text" id="itemInput" placeholder="Enter item (e.g., T-Shirt)" />
      <input type="number" id="qtyInput" placeholder="Qty" min="1" value="1" />
    </div>
    <div class="input-row">
      <select id="categorySelect">
        <option value="👕 Clothes">👕 Clothes</option>
        <option value="📱 Gadgets">📱 Gadgets</option>
        <option value="🧴 Toiletries">🧴 Toiletries</option>
        <option value="📄 Documents">📄 Documents</option>
        <option value="🍫 Snacks">🍫 Snacks</option>
      </select>
      <input type="file" id="photoInput" accept="image/*" capture="environment">
      <button class="primary" onclick="addItem()">Add</button>
    </div>
    <ul id="packingList"></ul>
    <div class="progress"><div class="progress-bar" id="progressBar"></div></div>
    <p id="progressText"></p>
  </div>

<script>
  const input = document.getElementById("itemInput");
  const qtyInput = document.getElementById("qtyInput");
  const categorySelect = document.getElementById("categorySelect");
  const photoInput = document.getElementById("photoInput");
  const list = document.getElementById("packingList");
  const progressBar = document.getElementById("progressBar");
  const progressText = document.getElementById("progressText");
  const bagCapacityInput = document.getElementById("bagCapacity");

  let items = JSON.parse(localStorage.getItem("packingList")) || [];
  let bagType = localStorage.getItem("bagType") || "Backpack";
  let bagCapacity = parseInt(localStorage.getItem("bagCapacity")) || 40;

  document.getElementById("bagType").value = bagType;
  bagCapacityInput.value = bagCapacity;

  renderList();

  document.getElementById("bagType").addEventListener("change", e => {
    bagType = e.target.value;
    localStorage.setItem("bagType", bagType);
  });
  bagCapacityInput.addEventListener("input", e => {
    bagCapacity = parseInt(e.target.value) || 0;
    localStorage.setItem("bagCapacity", bagCapacity);
    updateProgress();
  });

  function addItem() {
    const value = input.value.trim();
    const qty = parseInt(qtyInput.value) || 1;
    const category = categorySelect.value;

    if (!value) return;

    if (photoInput.files && photoInput.files[0]) {
      const reader = new FileReader();
      reader.onload = function(e) {
        const photo = e.target.result;
        items.push({ text:value, qty, packed:false, category, photo });
        saveAndRender();
      }
      reader.readAsDataURL(photoInput.files[0]);
    } else {
      items.push({ text:value, qty, packed:false, category, photo:null });
      saveAndRender();
    }

    input.value = "";
    qtyInput.value = 1;
    photoInput.value = "";
  }

  function togglePacked(i) {
    items[i].packed = !items[i].packed;
    saveAndRender();
  }

  function removeItem(i) {
    items.splice(i,1);
    saveAndRender();
  }

  function saveAndRender() {
    localStorage.setItem("packingList", JSON.stringify(items));
    renderList();
  }

  function renderList() {
    list.innerHTML = "";
    items.forEach((item,i) => {
      const li = document.createElement("li");
      li.className = item.packed ? "packed" : "";
      li.innerHTML = `
        <div class="item-left" onclick="togglePacked(${i})">
          ${item.photo ? `<img src="${item.photo}" class="thumb">` : ""}
          <span>${item.qty} × ${item.text} <span class="category">${item.category}</span></span>
        </div>
        <button onclick="removeItem(${i})">❌</button>
      `;
      list.appendChild(li);
    });
    updateProgress();
  }

  function updateProgress() {
    if (!bagCapacity || items.length === 0) {
      progressBar.style.width = "0%";
      progressText.textContent = "No items yet.";
      return;
    }
    const litersUsed = items.reduce((sum,i)=>sum+(i.qty*2),0);
    const percent = Math.min(100, Math.round((litersUsed/bagCapacity)*100));
    progressBar.style.width = percent+"%";
    progressText.textContent = `${litersUsed}L of ${bagCapacity}L used (${percent}%)`;
  }

  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./sw.js')
      .then(reg => {
        if (reg.waiting) reg.waiting.postMessage({action:'skipWaiting'});
      })
      .catch(err => console.error('SW registration failed:',err));
  }
</script>
</body>
</html>
